%%{init: {'theme':'base','flowchart':{'htmlLabels':true,'curve':'basis','nodeSpacing':45,'rankSpacing':70}} }%%
flowchart LR
  U[User]
  LINE[LINE OA]
  BRIDGE[LINE Bridge\nFastAPI plus MQTT client]
  MQTT[MQTT Broker]
  MAIN[ESP32 Main Board\nSecurity Controller]

  SENSORS[Door and Window Reed\nPIR Zone A Door and Window Room, Zone B, Outdoor\nVibration\nUltrasonic Door Zone, Window Zone, Between Room Zone\nKeypad and Buttons]
  ACT[Door Servo\nWindow Servo\nBuzzer\nOLED]

  U -->|chat commands| LINE
  LINE -->|messages and alerts| U
  LINE -->|webhook events| BRIDGE
  BRIDGE -->|push and reply messages| LINE
  BRIDGE -->|publish cmd| MQTT
  MQTT -->|deliver telemetry| BRIDGE
  MAIN -->|publish status/event/ack/metrics| MQTT
  MQTT -->|deliver cmd| MAIN
  SENSORS -->|sensor inputs| MAIN
  MAIN -->|actuator outputs| ACT

